<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>brlang - ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ããƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .editor-section {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        #codeInput {
            width: 100%;
            height: 200px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            background-color: #fafafa;
            resize: vertical;
        }
        #codeInput:focus {
            outline: none;
            border-color: #3498db;
        }
        .buttons {
            text-align: center;
            margin: 20px 0;
        }
        #runButton {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #runButton:hover {
            background-color: #219a52;
        }
        #runButton:active {
            transform: translateY(1px);
        }
        .output-section {
            margin-top: 30px;
        }
        #output {
            width: 100%;
            height: 150px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            background-color: #2c3e50;
            color: #ecf0f1;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .sample-code {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        #tokens {
            width: 100%;
            height: 120px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            background-color: #ecf0f1;
            color: #2c3e50;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        #tokenizeButton {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.3s;
        }
        
        #tokenizeButton:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
  <div class="container">
      <h1>ğŸš€ brlang å®Ÿè¡Œç’°å¢ƒ</h1>
      
      <div class="editor-section">
          <label for="codeInput">brlangã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›:</label>
          <textarea id="codeInput" placeholder="ã“ã“ã«brlangã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã ã•ã„...
  
  ä¾‹:
  print(&quot;Hello, World!&quot;)
  let x = 5 + 3
  print(x)"></textarea>
      </div>
      
      <div class="buttons">
          <button id="runButton">â–¶ï¸ å®Ÿè¡Œ</button>
          <button id="tokenizeButton">ğŸ” ãƒˆãƒ¼ã‚¯ãƒ³è§£æ</button>
      </div>
      
      <!-- ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’è¿½åŠ  -->
      <div class="output-section">
          <label for="tokens">ãƒˆãƒ¼ã‚¯ãƒ³è§£æçµæœ:</label>
          <div id="tokens"></div>
      </div>
      
      <div class="output-section">
          <label for="output">å®Ÿè¡Œçµæœ:</label>
          <div id="output"></div>
      </div>
      
      <div class="sample-code">
          <strong>ğŸ’¡ è©¦ã—ã¦ã¿ã‚ˆã†:</strong><br>
          <code>let x = 5 + 3</code> ã¨å…¥åŠ›ã—ã¦ã€Œãƒˆãƒ¼ã‚¯ãƒ³è§£æã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br>
          ã©ã‚“ãªãƒˆãƒ¼ã‚¯ãƒ³ã«åˆ†è§£ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚
      </div>
  </div>
  <script>
  // ã“ã“ã«JavaScriptã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™

  // ãƒˆãƒ¼ã‚¯ãƒ³ã®ç¨®é¡ã‚’å®šç¾©
  const TokenType = {
      // ãƒªãƒ†ãƒ©ãƒ«ï¼ˆå€¤ï¼‰
      NUMBER: 'NUMBER',           // 123, 45.67
      STRING: 'STRING',           // "Hello", 'World'
      IDENTIFIER: 'IDENTIFIER',   // å¤‰æ•°åã€é–¢æ•°å
      
      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
      LET: 'LET',                // let
      PRINT: 'PRINT',            // print
      
      // æ¼”ç®—å­
      PLUS: 'PLUS',              // +
      MINUS: 'MINUS',            // -
      MULTIPLY: 'MULTIPLY',      // *
      DIVIDE: 'DIVIDE',          // /
      ASSIGN: 'ASSIGN',          // =
      
      // åŒºåˆ‡ã‚Šæ–‡å­—
      LPAREN: 'LPAREN',          // (
      RPAREN: 'RPAREN',          // )
      COMMA: 'COMMA',            // ,
      
      // ç‰¹æ®Š
      NEWLINE: 'NEWLINE',        // æ”¹è¡Œ
      EOF: 'EOF'                 // ãƒ•ã‚¡ã‚¤ãƒ«çµ‚ç«¯
  };
  
  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚¯ãƒ©ã‚¹
  class Token {
      constructor(type, value, line = 0, column = 0) {
          this.type = type;      // ãƒˆãƒ¼ã‚¯ãƒ³ã®ç¨®é¡
          this.value = value;    // ãƒˆãƒ¼ã‚¯ãƒ³ã®å€¤
          this.line = line;      // è¡Œç•ªå·ï¼ˆã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç”¨ï¼‰
          this.column = column;  // åˆ—ç•ªå·ï¼ˆã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç”¨ï¼‰
      }
      
      toString() {
          return `Token(${this.type}, "${this.value}")`;
      }
  }
  
  // ãƒ¬ã‚­ã‚µãƒ¼ï¼ˆå­—å¥è§£æå™¨ï¼‰ã‚¯ãƒ©ã‚¹
  class Lexer {
      constructor(text) {
          this.text = text;           // è§£æã™ã‚‹æ–‡å­—åˆ—
          this.position = 0;          // ç¾åœ¨ã®ä½ç½®
          this.line = 1;              // ç¾åœ¨ã®è¡Œç•ªå·
          this.column = 1;            // ç¾åœ¨ã®åˆ—ç•ªå·
          this.currentChar = this.text[this.position] || null;
      }
      
      // ç¾åœ¨ä½ç½®ã‚’1ã¤é€²ã‚ã‚‹
      advance() {
          if (this.currentChar === '\n') {
              this.line++;
              this.column = 1;
          } else {
              this.column++;
          }
          
          this.position++;
          this.currentChar = this.position < this.text.length ? 
                            this.text[this.position] : null;
      }
      
      // ç©ºç™½æ–‡å­—ã‚’ã‚¹ã‚­ãƒƒãƒ—
      skipWhitespace() {
          while (this.currentChar && /\s/.test(this.currentChar) && this.currentChar !== '\n') {
              this.advance();
          }
      }
      
      // æ•°å€¤ã‚’èª­ã¿å–ã‚‹
      readNumber() {
          let number = '';
          let startColumn = this.column;
          
          while (this.currentChar && /[0-9.]/.test(this.currentChar)) {
              number += this.currentChar;
              this.advance();
          }
          
          return new Token(TokenType.NUMBER, parseFloat(number), this.line, startColumn);
      }
      
      // æ–‡å­—åˆ—ã‚’èª­ã¿å–ã‚‹
      readString() {
          let string = '';
          let quote = this.currentChar; // " ã¾ãŸã¯ '
          let startColumn = this.column;
          
          this.advance(); // é–‹å§‹ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
          
          while (this.currentChar && this.currentChar !== quote) {
              string += this.currentChar;
              this.advance();
          }
          
          if (this.currentChar === quote) {
              this.advance(); // çµ‚äº†ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—
          }
          
          return new Token(TokenType.STRING, string, this.line, startColumn);
      }
      
      // è­˜åˆ¥å­ï¼ˆå¤‰æ•°åã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰ã‚’èª­ã¿å–ã‚‹
      readIdentifier() {
          let identifier = '';
          let startColumn = this.column;
          
          while (this.currentChar && /[a-zA-Z_][a-zA-Z0-9_]*/.test(this.currentChar)) {
              identifier += this.currentChar;
              this.advance();
          }
          
          // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
          const keywords = {
              'let': TokenType.LET,
              'print': TokenType.PRINT
          };
          
          const tokenType = keywords[identifier] || TokenType.IDENTIFIER;
          return new Token(tokenType, identifier, this.line, startColumn);
      }
      
      // æ¬¡ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      getNextToken() {
          while (this.currentChar) {
              // ç©ºç™½ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ”¹è¡Œä»¥å¤–ï¼‰
              if (/\s/.test(this.currentChar) && this.currentChar !== '\n') {
                  this.skipWhitespace();
                  continue;
              }
              
              // æ”¹è¡Œ
              if (this.currentChar === '\n') {
                  const token = new Token(TokenType.NEWLINE, '\n', this.line, this.column);
                  this.advance();
                  return token;
              }
              
              // æ•°å€¤
              if (/[0-9]/.test(this.currentChar)) {
                  return this.readNumber();
              }
              
              // æ–‡å­—åˆ—
              if (this.currentChar === '"' || this.currentChar === "'") {
                  return this.readString();
              }
              
              // è­˜åˆ¥å­ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
              if (/[a-zA-Z_]/.test(this.currentChar)) {
                  return this.readIdentifier();
              }
              
              // å˜ä¸€æ–‡å­—ãƒˆãƒ¼ã‚¯ãƒ³
              const char = this.currentChar;
              const line = this.line;
              const column = this.column;
              
              this.advance();
              
              switch (char) {
                  case '+': return new Token(TokenType.PLUS, char, line, column);
                  case '-': return new Token(TokenType.MINUS, char, line, column);
                  case '*': return new Token(TokenType.MULTIPLY, char, line, column);
                  case '/': return new Token(TokenType.DIVIDE, char, line, column);
                  case '=': return new Token(TokenType.ASSIGN, char, line, column);
                  case '(': return new Token(TokenType.LPAREN, char, line, column);
                  case ')': return new Token(TokenType.RPAREN, char, line, column);
                  case ',': return new Token(TokenType.COMMA, char, line, column);
                  default:
                      throw new Error(`ä¸æ­£ãªæ–‡å­—: '${char}' (è¡Œ${line}, åˆ—${column})`);
              }
          }
          
          return new Token(TokenType.EOF, null, this.line, this.column);
      }
      
      // ã™ã¹ã¦ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
      getAllTokens() {
          const tokens = [];
          let token = this.getNextToken();
          
          while (token.type !== TokenType.EOF) {
              tokens.push(token);
              token = this.getNextToken();
          }
          
          tokens.push(token); // EOF ãƒˆãƒ¼ã‚¯ãƒ³ã‚‚è¿½åŠ 
          return tokens;
      }
  }
  
  // brlang ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ v0.2
  class BrlangInterpreter {
      constructor() {
          this.outputElement = document.getElementById('output');
          this.tokensElement = document.getElementById('tokens');
      }
      
      // çµæœã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
      print(message) {
          this.outputElement.textContent += message + '\n';
      }
      
      // å‡ºåŠ›ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•°
      clearOutput() {
          this.outputElement.textContent = '';
      }
      
      // ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•°
      clearTokens() {
          this.tokensElement.textContent = '';
      }
      
      // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
      showTokens(tokens) {
          this.clearTokens();
          this.tokensElement.textContent = 'ãƒˆãƒ¼ã‚¯ãƒ³è§£æçµæœ:\n\n';
          
          tokens.forEach((token, index) => {
              this.tokensElement.textContent += 
                  `${index + 1}. ${token.toString()}\n`;
          });
      }
      
      // ãƒˆãƒ¼ã‚¯ãƒ³è§£æã®ã¿ã‚’å®Ÿè¡Œ
      tokenize(code) {
          try {
              const lexer = new Lexer(code);
              const tokens = lexer.getAllTokens();
              this.showTokens(tokens);
              return tokens;
          } catch (error) {
              this.clearTokens();
              this.tokensElement.textContent = `ãƒˆãƒ¼ã‚¯ãƒ³è§£æã‚¨ãƒ©ãƒ¼: ${error.message}`;
              return null;
          }
      }
      
      // brlangã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
      execute(code) {
          this.clearOutput();
          
          try {
              // ã¾ãšãƒˆãƒ¼ã‚¯ãƒ³åŒ–
              const tokens = this.tokenize(code);
              if (!tokens) return;
              
              // printæ–‡ã®ã¿å‡¦ç†ï¼ˆä»Šå›ã¯ç°¡å˜ç‰ˆï¼‰
              this.executeSimple(tokens);
              
          } catch (error) {
              this.print(`å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
      }
      
      // ç°¡å˜ãªå®Ÿè¡Œé–¢æ•°ï¼ˆprintæ–‡ã®ã¿ï¼‰
      executeSimple(tokens) {
          let i = 0;
          
          while (i < tokens.length && tokens[i].type !== TokenType.EOF) {
              const token = tokens[i];
              
              // printæ–‡ã‚’å‡¦ç†
              if (token.type === TokenType.PRINT) {
                  i++; // print
                  
                  if (i < tokens.length && tokens[i].type === TokenType.LPAREN) {
                      i++; // (
                      
                      // å¼•æ•°ã‚’å–å¾—
                      if (i < tokens.length) {
                          const arg = tokens[i];
                          
                          if (arg.type === TokenType.STRING) {
                              this.print(arg.value);
                          } else if (arg.type === TokenType.NUMBER) {
                              this.print(arg.value.toString());
                          } else {
                              this.print(`ã‚¨ãƒ©ãƒ¼: æœªå¯¾å¿œã®å¼•æ•°ã‚¿ã‚¤ãƒ— ${arg.type}`);
                          }
                          
                          i++; // å¼•æ•°
                      }
                      
                      if (i < tokens.length && tokens[i].type === TokenType.RPAREN) {
                          i++; // )
                      }
                  } else {
                      this.print('ã‚¨ãƒ©ãƒ¼: printæ–‡ã®æ›¸å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                  }
              } else if (token.type === TokenType.NEWLINE) {
                  i++; // æ”¹è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
              } else {
                  this.print(`ã‚¨ãƒ©ãƒ¼: æœªå¯¾å¿œã®ãƒˆãƒ¼ã‚¯ãƒ³ ${token.type}`);
                  break;
              }
          }
      }
  }
  
  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
  const interpreter = new BrlangInterpreter();
  
  // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã®å‡¦ç†
  document.addEventListener('DOMContentLoaded', function() {
      const runButton = document.getElementById('runButton');
      const tokenizeButton = document.getElementById('tokenizeButton');
      const codeInput = document.getElementById('codeInput');
      
      // å®Ÿè¡Œãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
      runButton.addEventListener('click', function() {
          const code = codeInput.value;
          interpreter.execute(code);
      });
      
      // ãƒˆãƒ¼ã‚¯ãƒ³è§£æãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
      tokenizeButton.addEventListener('click', function() {
          const code = codeInput.value;
          interpreter.tokenize(code);
      });
      
      // Ctrl+Enter ã§å®Ÿè¡Œã€Ctrl+T ã§ãƒˆãƒ¼ã‚¯ãƒ³è§£æ
      codeInput.addEventListener('keydown', function(event) {
          if (event.ctrlKey && event.key === 'Enter') {
              const code = codeInput.value;
              interpreter.execute(code);
          } else if (event.ctrlKey && event.key === 't') {
              event.preventDefault();
              const code = codeInput.value;
              interpreter.tokenize(code);
          }
      });
      
      // åˆæœŸè¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      interpreter.print('brlang å®Ÿè¡Œç’°å¢ƒ v0.2 ã¸ã‚ˆã†ã“ãï¼');
      interpreter.print('æ–°æ©Ÿèƒ½: ãƒˆãƒ¼ã‚¯ãƒ³è§£æãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚');
      interpreter.print('');
  });

  </script>
</body>
</html>
